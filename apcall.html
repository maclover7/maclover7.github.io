<!DOCTYPE html>
<head>
  <title>apcall</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
  <div class="container">
    <h3>apcall</h3>

    <table class="table table-striped">
      <thead>
        <tr>
          <th>Race</th>
          <th>Estimated vote % in</th>
          <th>Winner</th>
          <th>Call time</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <script>
  // ** CHANGE THIS ** //
  const raceDate = '2022-11-08'; //'2023-05-16';
  const raceConfigs = [
    { id: 'NY-G-S-2022-11-08', name: 'Gillibrand' },
    { id: 'NY-G-H-22-2022-11-08', name: 'Mannion/Williams' },
    { id: 'NY-G-H-24-2022-11-08', name: 'Tenney' },
    { id: 'NY-G-SS-48-2022-11-08', name: 'May/Slater' },
    { id: 'NY-G-SS-50-2022-11-08', name: 'Ryan/Paro' },
    { id: 'NY-G-SH-126-2022-11-08', name: 'Lemondes/Phillips' },
    { id: 'NY-G-SH-127-2022-11-08', name: 'Stirpe/Kelly' },
    { id: 'NY-G-SH-128-2022-11-08', name: 'Hunter/Ciciarelli' },
    { id: 'NY-G-SH-129-2022-11-08', name: 'Magnarelli' },
    // 'PA-D-chief_executive-allegheny-2023-05-16'
  ];
  // ** ** //

  fetch(`https://static01.nyt.com/elections-assets/2022/data/${raceDate}/results-new-york.json`)
    .then((r) => r.json())
    .then((r) => {
      raceConfigs.forEach((raceConfig) => {
        const race = r.races.find((r) => r.nyt_id == raceConfig.id);

        let winnerText = '';
        if (race.outcome.won.length > 0) {
          winnerText = race.candidate_metadata[race.outcome.won[0]].last_name;
        }

        const table = document.getElementsByTagName('tbody')[0];
        table.innerHTML = `
          ${table.innerHTML}
          <tr>
            <td>${race.office} ${race.seat_number ? race.seat_number : ''} (${raceConfig.name})</td>
            <td>${race.top_reporting_unit.eevp ? race.top_reporting_unit.eevp : ''}</td>
            <td>${winnerText}</td>
            <td>${race.outcome.winner_accepted_at.length > 0 ? new Date(race.outcome.winner_accepted_at[0]).toLocaleString() : ''}</td>
          </tr>`;
      });
    });
  </script>
</body>
